<!doctype html>
<html lang='en'>
  <head>
    <title>Git racer</title>
    <meta charset='utf-8'>
    <link rel="stylesheet" type="text/css" href="css/application.css">
    <!-- <link rel="stylesheet" type="text/css" href="css/reset.css"> -->
    <link href='https://fonts.googleapis.com/css?family=Contrail+One|Fugaz+One|Russo+One' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <script src='https://code.jquery.com/jquery-2.1.1.min.js'></script>
    <script src='https://code.jquery.com/ui/1.11.2/jquery-ui.min.js'></script>
    <script src='js/handlebars.js'></script>
    <script src="js/jquery.barfiller.js" type="text/javascript"></script>
    <script src="js/interface.js" type="text/javascript"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

    $(document).ready(function() {
      $('#barfiller').progressbar({value: 0});
      $('#sign-in-button').on('click', function(event) {
        event.preventDefault();
        socket.emit('validate user', $('#githubUsername').val());
      });

      socket.on('validate result', function(isUserValid){
        console.log('is user valid ' + isUserValid);
        if (isUserValid){
          var username = $('#githubUsername').val();
          var data = {'username': username};
          var source = $('#template_meter').html();
          var template = Handlebars.compile(source);
          $('.bars').append(template(data));
          console.log($('.bars'));
          socket.on('commits', function(commits){
            console.log('commits: ' + commits);
            $('.sign-in').fadeOut(200, function() {
              $('#meter_' + username).attr('value', commits);
              $('#meter_' + username).delay(200).fadeIn();
              $('#username_' + username).text($('#githubUsername').val());
              $('#commits_'+ username).text('Commits Today: ' + commits + '/25')
            });
          });
       }
       else {
          $('.error').html('Invalid Github Profile');
        }
    });
  });

    </script>
    <%- body %>
  </body>
</html>